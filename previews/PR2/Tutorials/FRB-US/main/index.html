<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>FRB/US · StateSpaceEcon</title><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.png" alt="StateSpaceEcon logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">StateSpaceEcon</a></span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Welcome</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../">Introduction</a></li><li><a class="tocitem" href="../../README/">README</a></li><li><a class="tocitem" href="../../TimeSeriesEcon/main/">Time Series</a></li><li><a class="tocitem" href="../../simple_RBC/main/">Simple RBC Model</a></li><li><a class="tocitem" href="../../US_SW07/main/">Smets and Wouters 2007</a></li><li class="is-active"><a class="tocitem" href>FRB/US</a><ul class="internal"><li><a class="tocitem" href="#Getting-started"><span>Getting started</span></a></li><li><a class="tocitem" href="#The-Model-File"><span>The Model File</span></a></li><li><a class="tocitem" href="#Load-the-Model"><span>Load the Model</span></a></li><li><a class="tocitem" href="#Load-the-Longbase-Data"><span>Load the Longbase Data</span></a></li><li><a class="tocitem" href="#Load-set_policy.jl"><span>Load <code>set_policy.jl</code></span></a></li><li><a class="tocitem" href="#Prepare-the-Simulation-Plan"><span>Prepare the Simulation Plan</span></a></li><li><a class="tocitem" href="#Prepare-the-Exogenous-Data"><span>Prepare the Exogenous Data</span></a></li><li><a class="tocitem" href="#Back-out-the-Shocks"><span>Back out the Shocks</span></a></li><li><a class="tocitem" href="#Recover-the-Baseline-Case"><span>Recover the Baseline Case</span></a></li><li><a class="tocitem" href="#Simulate-a-shock"><span>Simulate a shock</span></a></li></ul></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../../../Reference/TimeSeriesEcon/">TimeSeriesEcon</a></li><li><a class="tocitem" href="../../../Reference/ModelBaseEcon/">ModelBaseEcon</a></li><li><a class="tocitem" href="../../../Reference/StateSpaceEcon/">StateSpaceEcon</a></li><li><a class="tocitem" href="../../../Reference/FAME/">FAME</a></li></ul></li><li><span class="tocitem">Design Papers</span><ul><li><a class="tocitem" href="../../../DesignPapers/">Design Papers</a></li><li><a class="tocitem" href="../../../DesignPapers/final_conditions/">Final Conditions</a></li><li><a class="tocitem" href="../../../DesignPapers/log_variables/">Log-variables</a></li></ul></li><li><a class="tocitem" href="../../../indexpage/">Index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>FRB/US</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>FRB/US</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/bankofcanada/TutorialsEcon.jl/blob/master/FRB-US/main.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="FRB/US-with-VAR-based-Expectations"><a class="docs-heading-anchor" href="#FRB/US-with-VAR-based-Expectations">FRB/US with VAR-based Expectations</a><a id="FRB/US-with-VAR-based-Expectations-1"></a><a class="docs-heading-anchor-permalink" href="#FRB/US-with-VAR-based-Expectations" title="Permalink"></a></h1><h2 id="Getting-started"><a class="docs-heading-anchor" href="#Getting-started">Getting started</a><a id="Getting-started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-started" title="Permalink"></a></h2><p>If you wish to run the code of this tutorial, or to experiment for yourself, make sure to follow the instructions in <a href="../../#Getting-started">Introduction/Getting_started</a>.</p><h2 id="The-Model-File"><a class="docs-heading-anchor" href="#The-Model-File">The Model File</a><a id="The-Model-File-1"></a><a class="docs-heading-anchor-permalink" href="#The-Model-File" title="Permalink"></a></h2><p>We recommend placing the model definition in its own Julia module in a separate source file. Although this is not strictly necessary, it helps to keep the code well organized and it also allows us to take advantage of pre-compilation. The first time we load the model file it takes some time to compile, and after that loading is much faster.</p><p>The FRB/US model we will be working with is located in <a href="../models/FRBUS_VAR.jl"><code>models/FRBUS_VAR.jl</code></a>.  This file was automatically generated from the <code>model.xml</code> file contained within <a href="https://www.federalreserve.gov/econres/us-models-package.htm"><code>frbus_package.zip</code></a>.</p><h3 id="Some-Notes-About-the-Julia-Model-File"><a class="docs-heading-anchor" href="#Some-Notes-About-the-Julia-Model-File">Some Notes About the Julia Model File</a><a id="Some-Notes-About-the-Julia-Model-File-1"></a><a class="docs-heading-anchor-permalink" href="#Some-Notes-About-the-Julia-Model-File" title="Permalink"></a></h3><ol><li><p>Some variables are declared as <em>log variables</em> using the <code>@log</code> declaration within a <code>@variables</code> block. For example</p><pre><code class="language-julia hljs">@variables model begin
    # ... #
    &quot;Investment in equipment, current \$&quot; @log ebfin
    &quot;Personal consumption expenditures, current \$ (NIPA definition)&quot; @log ecnian
    # ... #
end</code></pre><p>A full discussion of log variables is beyond the scope of this tutorial.  However a very simplified explanation is that this improves the stability of  the numerical solver for variables which are always positive.</p></li><li><p>Variables which do not have an associated equation, and for which data is always given, are declared <em>exogenous</em> using an <code>@exogenous</code> block. For example</p><pre><code class="language-julia hljs">@exogenous model begin
    # Exogenous variables:
    &quot;Potential government employment ratio (relative to business)&quot; adjlegrt
    &quot;Dummy, post-1979 indicator&quot; d79a
    &quot;Dummy, 1980-1995 indicator&quot; d8095
    # ... #
end</code></pre></li><li><p>The EViews syntax is translated to Julia syntax. EViews functions <code>d()</code> and <code>dlog()</code> are replaced with their equivalent StateSpaceEcon <em>meta functions</em> <code>@d()</code> and <code>@dlog()</code>. EViews <code>@movav()</code> is left alone, because a <em>meta function</em> by the same name already exists in StateSpaceEcon, and does the same thing. Finally, the EViews <code>@recode()</code> is replaced with the equivalent Julia function <code>ifelse()</code>, or where appropriate with a <code>min()</code> or a <code>max()</code>.</p></li><li><p>Several equations contain expressions matching the pattern <code>1 / (1 + exp(-cx))</code>, where <code>c</code> is a large constant (usually 25) and <code>x</code> is some expression. This sigmoid function is a smooth approximation of the Heaviside step function for large values of <code>c</code>. While mathematically the derivative of this function is well defined and converges to approximately zero everywhere outside a very small interval containing 0, numerically it causes problems because it results in either 0/0 or ∞/∞. To remedy this situation, we replace such patterns with equivalent calls to <code>heaviside(cx)</code>, where the function <code>heaviside()</code> is defined in the model file.</p><pre><code class="language-julia hljs">export heaviside
&quot;Heaviside step function&quot; @inline heaviside(x) = convert(typeof(x), x&gt;zero(x))</code></pre></li></ol><h3 id="Regenerating-the-Model-File"><a class="docs-heading-anchor" href="#Regenerating-the-Model-File">Regenerating the Model File</a><a id="Regenerating-the-Model-File-1"></a><a class="docs-heading-anchor-permalink" href="#Regenerating-the-Model-File" title="Permalink"></a></h3><p>We have included the script <a href="../update_models.jl"><code>update_models.jl</code></a>. It is not necessary for running the code below, but it may be helpful for further experimentation.</p><p>If the model file is missing, for some reason or another, this script will automatically download <code>frbus_package.zip</code> and process the <code>model.xml</code> within it to re-generate <code>model/FRBUS_VAR.jl</code>. This could also be useful if you make modifications to <code>model.xml</code> (including not only the equations, but also the parameter values), or if you want to use a different FRBUS package from the one posted on the FRBUS website. In this case, simply place your <code>frbus_package.zip</code> in the <code>models/</code> directory and run <code>update_models.jl</code>. Of course such modifications can also be done directly into the existing <code>models/FRBUS_VAR.jl</code> file.</p><p>Note that after updating <code>models/FRBUS_VAR.jl</code>, it&#39;d be best to restart the REPL. The first time you load the new model module it&#39;ll take a bit longer due to pre-compilation.</p><h2 id="Load-the-Model"><a class="docs-heading-anchor" href="#Load-the-Model">Load the Model</a><a id="Load-the-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Load-the-Model" title="Permalink"></a></h2><p>Assuming that the <code>models/</code> directory is already in the <code>LOAD_PATH</code> list, we can load the model by <code>using</code> its module. Once loaded, the module contains a variable <code>model</code> which represents the model object.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using FRBUS_VAR</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; m = FRBUS_VAR.model</code><code class="nohighlight hljs ansi" style="display:block;">374 variable(s), 285 shock(s), 140 parameter(s), 285 equations(s) with 117 auxiliary equations.</code></pre><p>We see that the model has a number of variables, shocks, equations, and parameters. The total number of variables include exogenous variables.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; m.variables</code><code class="nohighlight hljs ansi" style="display:block;">374-element Vector{ModelVariable}:
 &quot;Federal funds rate, first diff&quot; delrff
 &quot;Price inflation aggregation discrepancy&quot; dpgap
 &quot;Investment in equipment, current $&quot; @log ebfin
 &quot;Personal consumption expenditures, current $ (NIPA definition)&quot; @log ecnian
 &quot;Federal Government expenditures, current $&quot; @log egfen
 &quot;Federal government employee compensation, current $&quot; @log egfln
 &quot;S&amp;L Government expenditures, current $&quot; @log egsen
 &quot;S&amp;L government employee compensation, current $&quot; @log egsln
 &quot;Residential investment expenditures&quot; @log ehn
 &quot;Change in private inventories, cw 2012$&quot; ei
 ⋮
 &quot;Multiplicative factor (Consumer interest payments to business)&quot; @exog uyhibn
 &quot;Multiplicative factor in YHLN identity&quot; @exog uyhln
 &quot;Multiplicative factor in YHPTN identity&quot; @exog uyhptn
 &quot;Multiplicative factor in personal saving identity (accounts for transfers to foreign&quot; @exog uyhsn
 &quot;Multiplicative factor in YHTN identity&quot; @exog uyhtn
 &quot;Multiplicative factor in YLN identity&quot; @exog uyl
 &quot;Multiplicative factor in YNIN identity&quot; @exog uyni
 &quot;Multiplicative factor in YPN identity&quot; @exog uyp
 &quot;Microsoft one-time dividend payout in 2004Q4&quot; @exog ymsdn</code></pre><p>We also see that the model object includes a number of auxiliary equations. These equations (and variables) are automatically added as substitutions for expressions that must be positive.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; m.auxeqns</code><code class="nohighlight hljs ansi" style="display:block;">117-element Vector{Equation}:
 exp(aux1[t]) = phr[t] * pxp[t]
 exp(aux2[t]) = pbfir[t] * pxp[t]
 exp(aux3[t]) = pegfr[t] * pxp[t]
 exp(aux4[t]) = pegsr[t] * pxp[t]
 exp(aux5[t]) = pxr[t] * pxp[t]
 exp(aux6[t]) = ((pbfir[t] * pxp[t]) / pxb[t]) / ((pbfir[t - 1] * pxp[t - 1]) / pxb[t - 1])
 exp(aux7[t]) = ((ynicpn[t] - tcin[t]) * 0.5) / pxb[t]
 exp(aux8[t]) = leg[t]
 exp(aux9[t]) = uleg[t]
 exp(aux10[t]) = lprdt[t]
 ⋮
 exp(aux109[t]) = xbtr[t]
 exp(aux110[t]) = xbtr[t - 1]
 exp(aux111[t]) = qynidn[t - 1] / (ynidn[t - 1] - ymsdn[t - 1])
 exp(aux112[t]) = zyhpst[t]
 exp(aux113[t]) = zyhpst[t - 1]
 exp(aux114[t]) = zyhst[t]
 exp(aux115[t]) = zyhst[t - 1]
 exp(aux116[t]) = zyhtst[t]
 exp(aux117[t]) = zyhtst[t - 1]</code></pre><p>For example, we see that variable <code>aux1</code> was added with the first equation in the above list. At the same time, in equation for <code>dpgap</code>, the expression <code>log(phr[t] * pxp[t])</code> has been replaced by <code>aux1[t]</code>.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; m.equations[2]</code><code class="nohighlight hljs ansi" style="display:block;">&quot;Price inflation aggregation discrepancy&quot; dpgap[t] - dpgap_a[t] = pipxnc[t] / 400 - (y_dpgap[1] * @d(aux1[t], 0, 1) + y_dpgap[2] * @d(aux2[t], 0, 1) + (y_dpgap[3] + y_dpgap[4]) * @d(aux3[t], 0, 1) + (y_dpgap[5] + y_dpgap[6]) * @d(aux4[t], 0, 1) + y_dpgap[7] * @d(aux5[t], 0, 1))</code></pre><p>A detailed discussion of auxiliary variables and equations is beyond the scope of this tutorial. It suffices to say that we can safely ignore their presence for now.</p><h2 id="Load-the-Longbase-Data"><a class="docs-heading-anchor" href="#Load-the-Longbase-Data">Load the Longbase Data</a><a id="Load-the-Longbase-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Load-the-Longbase-Data" title="Permalink"></a></h2><p>Unfortunately the <code>longbase</code> data is available only in EViews format, which cannot be read automatically by open source software (at least to our knowledge). For convenience, here we have included the version of <code>longbase</code> from 23-07-2020 in a csv format and a function that loads that data. The function is defined in file <a href="../load_longbase.jl"><code>load_longbase.jl</code></a>. Note that this is not a module, so we load it by calling <code>include()</code>, not <code>using</code>.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; include(&quot;load_longbase.jl&quot;)</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; longbase = load_longbase(&quot;longbase_23072020.csv&quot;)</code><code class="nohighlight hljs ansi" style="display:block;">834×659 MVTSeries{Quarterly} with range 1962Q1:2170Q2 and variables (delrff,…):
           delrff        dpgap        … zyhst_a     zyhtst_a
  1962Q1 :  0.0685484     0.000764569 … 0.0         0.0
  1962Q2 :  0.217238      0.00275388  … 0.0         0.0
  1962Q3 :  0.204613      0.000698806 … 0.0         0.0
  1962Q4 :  0.0755952    -0.00221103  … 0.0         0.0
  1963Q1 :  0.0320355     0.0037094   … 0.0         0.0
  1963Q2 : -0.0004879    -0.000103025 … 0.0         0.0
  1963Q3 :  0.3484       -0.0025974   … 0.0         0.0
  1963Q4 :  0.129547      0.00266941  … 0.0         0.0
  1964Q1 :  0.0220531    -0.000553979 … 0.0         0.0
           ⋮             ⋮            ⋱ ⋮           ⋮
  2168Q2 : -1.11022e-13   0.0         … 0.0         0.0
  2168Q3 : -8.43769e-14   0.0         … 0.0         0.0
  2168Q4 : -1.0969e-13    0.0         … 0.0         0.0
  2169Q1 : -6.66134e-14   0.0         … 0.0         0.0
  2169Q2 :  0.0           0.0         … 0.0         0.0
  2169Q3 :  2.35367e-14   0.0         … 0.0         0.0
  2169Q4 :  1.77192e-13   0.0         … 0.0         0.0
  2170Q1 :  1.31894e-13   0.0         … 0.0         0.0
  2170Q2 :  9.19265e-14   0.0         … 0.0         0.0</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><h2 id="Load-set_policy.jl"><a class="docs-heading-anchor" href="#Load-set_policy.jl">Load <code>set_policy.jl</code></a><a id="Load-set_policy.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Load-set_policy.jl" title="Permalink"></a></h2><p>The model contains a number of switch variables to control which monetary policy function is used and which fiscal policy function is used at each period of the simulation. For convenience, we have included functions <code>set_mp!()</code> and <code>set_fp!()</code>, which are defined in <a href="../set_policy.jl"><code>set_policy.jl</code></a>.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; include(&quot;set_policy.jl&quot;)</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @doc set_mp!</code><code class="nohighlight hljs ansi" style="display:block;">  set_mp!(data, switch[, range])

  Set the monetary policy function over the given range. The given switch is
  set to 1 and all other monetary policy switches are set to 0. If range is
  not given, the switch is set over the full range of the data.

  The set of valid switch values is in dmp_switches.</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; dmp_switches</code><code class="nohighlight hljs ansi" style="display:block;">(:dmpintay, :dmptay, :dmptlr, :dmpalt, :dmpgen, :dmpex, :dmprr)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @doc set_fp!</code><code class="nohighlight hljs ansi" style="display:block;">  set_fp!(data, switch[, range])

  Set the fiscal policy function over the given range. The given switch is set
  to 1 and all other fiscal policy switches are set to 0. If range is not
  given, the switch is set over the full range of the data.

  The set of valid switch values is in dfp_switches.</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; dfp_switches</code><code class="nohighlight hljs ansi" style="display:block;">(:dfpex, :dfpsrp, :dfpdbt)</code></pre><h2 id="Prepare-the-Simulation-Plan"><a class="docs-heading-anchor" href="#Prepare-the-Simulation-Plan">Prepare the Simulation Plan</a><a id="Prepare-the-Simulation-Plan-1"></a><a class="docs-heading-anchor-permalink" href="#Prepare-the-Simulation-Plan" title="Permalink"></a></h2><p>The simulation is controlled by a <a href="../../../Reference/StateSpaceEcon/#StateSpaceEcon.Plans.Plan"><code>Plan</code></a> object. The plan is defined by a model object and a simulation range. The full range handled by the plan contains additional periods before and after the simulation range, which account for initial and final conditions. By default, the simulation plan is setup such that all shocks are exogenous and all variables are endogenous, except for the variables that are declared either in an <code>@exogenous</code> block or with the <code>@exog</code> declaration within an <code>@variables</code> block in the model file.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; sim = 2020Q1:2025Q4     # simulation range</code><code class="nohighlight hljs ansi" style="display:block;">2020Q1:2025Q4</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p = Plan(m, sim)        # the plan object</code><code class="nohighlight hljs ansi" style="display:block;">Plan{MIT{Quarterly}} with range 2018Q3:2025Q4
  2018Q3:2025Q4 → adjlegrt, d79a, d8095, d83, d87, ddockm, ddockx, deuc, …</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; ini = firstdate(p):first(sim) - 1      # range of initial conditions</code><code class="nohighlight hljs ansi" style="display:block;">2018Q3:2019Q4</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; fin = last(sim) + 1:lastdate(p)        # range of final conditions</code><code class="nohighlight hljs ansi" style="display:block;">2026Q1:2025Q4</code></pre><p>Note that the <code>fin</code> range is actually empty. This is because this model doesn&#39;t have any leads.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; isempty(fin)</code><code class="nohighlight hljs ansi" style="display:block;">true</code></pre><h2 id="Prepare-the-Exogenous-Data"><a class="docs-heading-anchor" href="#Prepare-the-Exogenous-Data">Prepare the Exogenous Data</a><a id="Prepare-the-Exogenous-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Prepare-the-Exogenous-Data" title="Permalink"></a></h2><p>We start by pre-allocating simulation data that is set to 0 everywhere.  Then we assign within it the data from <code>longbase</code> using Julia&#39;s <code>.=</code> operator.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; ed = zerodata(m, p);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; ed .= longbase[p.range];</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>Next we set the monetary policy, the fiscal policy and a few other switches.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; # set monetary policy
       set_mp!(ed, :dmpintay);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # turn off zero bound and policy thresholds;
       # hold policy maker&#39;s perceived equilibrium real interest rate
       ed.dmptrsh .= 0.0;</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; ed.rffmin .= -9999;</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; ed.drstar .= 0.0;</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # set fiscal policy
       set_fp!(ed, :dfpsrp);</code><code class="nohighlight hljs ansi" style="display:block;"></code><code class="nohighlight hljs ansi" style="display:block;"></code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><h2 id="Back-out-the-Shocks"><a class="docs-heading-anchor" href="#Back-out-the-Shocks">Back out the Shocks</a><a id="Back-out-the-Shocks-1"></a><a class="docs-heading-anchor-permalink" href="#Back-out-the-Shocks" title="Permalink"></a></h2><p>The first simulation test is to compute the shocks given the variable paths from <code>longbase</code>. To do this, we swap the variables and shocks, making variables exogenous and shocks endogenous. The mapping between variables and their corresponding shocks is declared in the model file, so we can simply call <a href="../../../Reference/StateSpaceEcon/#StateSpaceEcon.Plans.autoexogenize!-Tuple{Plan, Model, Any}"><code>autoexogenize!</code></a>. We make a copy of the plan <code>p</code>, so that the original plan would not be modified. We also make a copy of the exogenous data, <code>ed</code>, so that the original would remain unchanged.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; p_0 = autoexogenize!(copy(p), m, sim)</code><code class="nohighlight hljs ansi" style="display:block;">Plan{MIT{Quarterly}} with range 2018Q3:2025Q4
  2018Q3:2019Q4 → adjlegrt, d79a, d8095, d83, d87, ddockm, ddockx, deuc, …
  2020Q1:2025Q4 → delrff, dpgap, ebfin, ecnian, egfen, egfln, egsen, egsln, …</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; ed_0 = copy(ed)</code><code class="nohighlight hljs ansi" style="display:block;">30×659 MVTSeries{Quarterly} with range 2018Q3:2025Q4 and variables (delrff,…):
           delrff        dpgap        … zyhst_a     zyhtst_a
  2018Q3 :  0.186305      0.000457196 … 0.0         0.0
  2018Q4 :  0.293605      0.000848632 … 0.0         0.0
  2019Q1 :  0.184215     -0.000611408 … 0.0         0.0
  2019Q2 : -0.00349898   -2.89253e-5  … 0.0         0.0
  2019Q3 : -0.2          -0.000753725 … 0.0         0.0
  2019Q4 : -0.547329      8.52626e-5  … 0.0         0.0
  2020Q1 : -0.417581     -0.000607578 … 0.0         0.0
  2020Q2 : -1.1329       -0.000146469 … 0.0         0.0
  2020Q3 :  5.75591e-10  -0.000256312 … 0.0         0.0
           ⋮             ⋮            ⋱ ⋮           ⋮
  2023Q4 :  0.2601       -3.98833e-6  … 0.0         0.0
  2024Q1 :  0.221085      4.10226e-5  … 0.0         0.0
  2024Q2 :  0.187922      7.65344e-5  … 0.0         0.0
  2024Q3 :  0.159734      0.000101149 … 0.0         0.0
  2024Q4 :  0.135774      0.000115534 … 0.0         0.0
  2025Q1 :  0.115408      0.000121624 … 0.0         0.0
  2025Q2 :  0.0980966     0.000122371 … 0.0         0.0
  2025Q3 :  0.0833821     0.000120246 … 0.0         0.0
  2025Q4 :  0.0708748     0.000116766 … 0.0         0.0</code></pre><p>Now we run the <a href="../../../Reference/StateSpaceEcon/#StateSpaceEcon.StackedTimeSolver.simulate"><code>simulate</code></a> command. Note that the first time we run a function in Julia it takes a bit longer due to compilation time. In this case, it takes much longer because the model is very large and each and every equation gets compiled together with its automatic derivative.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; sol_0 = @time simulate(m, p_0, ed_0; verbose=true, tol=1e-12);</code><code class="nohighlight hljs ansi" style="display:block;">[ Info: Simulating 2020Q1:2025Q4
[ Info: 1, || Fx || = 45.198000000000434, || Δx || = 45.198000000000434
[ Info: 2, || Fx || = 8.731149137020111e-11, || Δx || = 1.0092686030637524e-13
 80.964691 seconds (101.39 M allocations: 9.390 GiB, 3.50% gc time, 2.09% compilation time)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @test sol_0[m.variables] ≈ ed[m.variables]</code><code class="nohighlight hljs ansi" style="display:block;">Test Passed</code></pre><p>The compilation is done once and the compiled code is used in every call after that. So the second call to <a href="../../../Reference/StateSpaceEcon/#StateSpaceEcon.StackedTimeSolver.simulate"><code>simulate</code></a> is much, much faster.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; sol_0 = @time simulate(m, p_0, ed_0; verbose=true, tol=1e-12);</code><code class="nohighlight hljs ansi" style="display:block;">[ Info: Simulating 2020Q1:2025Q4
[ Info: 1, || Fx || = 45.198000000000434, || Δx || = 45.198000000000434
[ Info: 2, || Fx || = 8.731149137020111e-11, || Δx || = 1.0092686030637524e-13
  2.004316 seconds (1.05 M allocations: 3.763 GiB, 17.58% gc time)</code></pre><h2 id="Recover-the-Baseline-Case"><a class="docs-heading-anchor" href="#Recover-the-Baseline-Case">Recover the Baseline Case</a><a id="Recover-the-Baseline-Case-1"></a><a class="docs-heading-anchor-permalink" href="#Recover-the-Baseline-Case" title="Permalink"></a></h2><p>Next simulation is a sanity check test. If we run a simulation with the shocks set to the values we just backed out, the resulting variable paths must match the ones we started with.</p><p>Once again we start with an exogenous data set everywhere to 0. Then we assign only the initial conditions and the shocks we just backed out.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; p_r = Plan(m, sim);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; ed_r = zerodata(m, p_r);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # initial conditions for the variables are taken from longbase
       ed_r[ini, m.variables] .= longbase[ini, m.variables];</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # shocks are taken from from sol_0
       ed_r[p_r.range, m.shocks] .= sol_0[p_r.range, m.shocks];</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # exogenous variables are also taken  from sol_0
       exogenous = [v for v in m.variables if isexog(v)];</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; ed_r[p_r.range, exogenous] .= sol_0[p_r.range, exogenous];</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>Now, the only thing left is to set the initial guess for the endogenous variables. If we leave it at 0, that would be an initial guess too far from the solution and the Newton-Raphson will likely diverge. If we set it to the known solution, that would diminish this exercise to merely verifying that it is indeed a solution (we already know that). So, to make things a bit more interesting, we add a bit of noise to the true solution.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; endogenous = [v for v in m.variables if !isexog(v)];</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; ed_r[sim, endogenous] .= longbase[sim, endogenous] .+ 0.03.*randn(length(sim), length(endogenous));</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>Once again we have to set the monetary policy and the fiscal policy rules, as well as the values of some of the other switches.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; set_mp!(ed_r, :dmpintay);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; ed_r.dmptrsh .= 0.0;</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; ed_r.rffmin .= -9999;</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; ed_r.drstar .= 0.0;</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; set_fp!(ed_r, :dfpsrp);</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>And finally we can run the simulation and check to make sure that indeed the recovered simulation matches the base case.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; sol_r = @time simulate(m, p_r, ed_r; verbose=true, tol=1e-9);</code><code class="nohighlight hljs ansi" style="display:block;">[ Info: Simulating 2020Q1:2025Q4
[ Info: 1, || Fx || = 1801.63396172543, || Δx || = 1613.4856099122246
[ Info: 2, || Fx || = 442.8938654549952, || Δx || = 1757.076236124595
[ Info: 3, || Fx || = 105.0301811476711, || Δx || = 142.84376895042803
[ Info: 4, || Fx || = 1.984373618353402, || Δx || = 1.2802774327509476
[ Info: 5, || Fx || = 0.011723702365571853, || Δx || = 0.0003658292289531272
[ Info: 6, || Fx || = 4.3339397848285444e-7, || Δx || = 2.9443911363138447e-9
[ Info: 7, || Fx || = 1.4551915228366852e-10
  2.835003 seconds (2.28 M allocations: 4.050 GiB, 13.15% gc time)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @test sol_r ≈ sol_0</code><code class="nohighlight hljs ansi" style="display:block;">Test Passed</code></pre><h2 id="Simulate-a-shock"><a class="docs-heading-anchor" href="#Simulate-a-shock">Simulate a shock</a><a id="Simulate-a-shock-1"></a><a class="docs-heading-anchor-permalink" href="#Simulate-a-shock" title="Permalink"></a></h2><p>The last exercise is to simulate the impulse response to a unit shock in <code>rffintay</code>.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; m.rffintay</code><code class="nohighlight hljs ansi" style="display:block;">&quot;Value of eff. federal funds rate given by the inertial Taylor rule&quot; rffintay</code></pre><p>We start with the base case and add 1 to the <code>rffintay_a</code> shock at the first period of the simulation.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; p_1 = Plan(m, sim);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; ed_1 = copy(sol_0);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; ed_1.rffintay_a[first(sim)] += 1;</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; sol_1 = @time simulate(m, p_1, ed_1; verbose=true, tol=1e-9);</code><code class="nohighlight hljs ansi" style="display:block;">[ Info: Simulating 2020Q1:2025Q4
[ Info: 1, || Fx || = 1.0, || Δx || = 3515.282226508384
[ Info: 2, || Fx || = 248.8794918980675, || Δx || = 237.60649383794194
[ Info: 3, || Fx || = 0.16150616914092097, || Δx || = 0.01284261685002624
[ Info: 4, || Fx || = 4.511150564212585e-7, || Δx || = 3.791120055923335e-9
[ Info: 5, || Fx || = 1.3096723705530167e-10
  2.522271 seconds (1.79 M allocations: 3.951 GiB, 13.54% gc time)</code></pre><p>Finally, we can plot the impulse response function to see what we&#39;ve done.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; # compute the differences between the base case and the shocked simulation.
       dd = hcat(SimData(p.range),
           d_rff=sol_1.rff - sol_0.rff,
           d_rg10=sol_1.rg10 - sol_0.rg10,
           d_lur=sol_1.lur - sol_0.lur,
           d_pic4=sol_1.pic4 - sol_0.pic4,
       );</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # produce the plot
       plot(dd[sim], vars=(:d_rff, :d_rg10, :d_lur, :d_pic4),
            legend=false, size=(600, 400));</code><code class="nohighlight hljs ansi" style="display:block;">┌ Warning: Keyword argument xformatter not supported with Plots.GRBackend().  Choose from: annotations, arrow, aspect_ratio, background_color, background_color_inside, background_color_outside, background_color_subplot, bar_width, bins, bottom_margin, camera, clims, color_palette, colorbar, colorbar_entry, colorbar_scale, colorbar_title, connections, contour_labels, discrete_values, fill_z, fillalpha, fillcolor, fillrange, flip, foreground_color, foreground_color_axis, foreground_color_border, foreground_color_grid, foreground_color_subplot, foreground_color_text, framestyle, grid, gridalpha, gridlinewidth, gridstyle, group, guide, guidefontcolor, guidefontfamily, guidefonthalign, guidefontrotation, guidefontsize, guidefontvalign, html_output_format, inset_subplots, label, layout, left_margin, legend_background_color, legend_font_color, legend_font_family, legend_font_halign, legend_font_pointsize, legend_font_rotation, legend_font_valign, legend_foreground_color, legend_position, legend_title, levels, lims, line_z, linealpha, linecolor, linestyle, linewidth, link, margin, marker_z, markeralpha, markercolor, markershape, markersize, markerstrokealpha, markerstrokecolor, markerstrokewidth, normalize, orientation, overwrite_figure, polar, primary, projection, quiver, ribbon, right_margin, scale, series_annotations, seriesalpha, seriescolor, seriestype, show, show_empty_bins, size, smooth, subplot, subplot_index, tick_direction, tickfontcolor, tickfontfamily, tickfonthalign, tickfontrotation, tickfontsize, tickfontvalign, ticks, title, titlefontcolor, titlefontfamily, titlefonthalign, titlefontrotation, titlefontsize, titlefontvalign, top_margin, weights, window_title, x, xdiscrete_values, xerror, xflip, xforeground_color_axis, xforeground_color_border, xforeground_color_grid, xforeground_color_text, xgrid, xgridalpha, xgridlinewidth, xgridstyle, xguide, xguidefontcolor, xguidefontfamily, xguidefonthalign, xguidefontrotation, xguidefontsize, xguidefontvalign, xlims, xlink, xscale, xtick_direction, xtickfontcolor, xtickfontfamily, xtickfonthalign, xtickfontrotation, xtickfontsize, xtickfontvalign, xticks, y, ydiscrete_values, yerror, yflip, yforeground_color_axis, yforeground_color_border, yforeground_color_grid, yforeground_color_text, ygrid, ygridalpha, ygridlinewidth, ygridstyle, yguide, yguidefontcolor, yguidefontfamily, yguidefonthalign, yguidefontrotation, yguidefontsize, yguidefontvalign, ylims, ylink, yscale, ytick_direction, ytickfontcolor, ytickfontfamily, ytickfonthalign, ytickfontrotation, ytickfontsize, ytickfontvalign, yticks, z, z_order, zdiscrete_values, zerror, zflip, zforeground_color_axis, zforeground_color_border, zforeground_color_grid, zforeground_color_text, zgrid, zgridalpha, zgridlinewidth, zgridstyle, zguide, zguidefontcolor, zguidefontfamily, zguidefonthalign, zguidefontrotation, zguidefontsize, zguidefontvalign, zlims, zlink, zscale, ztick_direction, ztickfontcolor, ztickfontfamily, ztickfonthalign, ztickfontrotation, ztickfontsize, ztickfontvalign, zticks
└ @ Plots ~/.julia/packages/Plots/dNEbX/src/args.jl:1628</code></pre><p><a href="../irf.png"><img src="../irf.png" alt="Impulse Response Graph"/></a></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../US_SW07/main/">« Smets and Wouters 2007</a><a class="docs-footer-nextpage" href="../../../Reference/TimeSeriesEcon/">TimeSeriesEcon »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.15 on <span class="colophon-date" title="Wednesday 6 April 2022 20:03">Wednesday 6 April 2022</span>. Using Julia version 1.6.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
